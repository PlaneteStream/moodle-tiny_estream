define("tiny_estream/ui",["exports","tiny_estream/modal","core/modal_factory","./options"],(function(_exports,_modal,_modal_factory,_options){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * eStream TinyMCE
   *
   * @module      tiny_estream/ui
   * @copyright   2023 Uniguest <ben.goulden@uniguest.com>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.handleAction=void 0,_modal=_interopRequireDefault(_modal),_modal_factory=_interopRequireDefault(_modal_factory);_exports.handleAction=editor=>{displayDialogue(editor)};const getTemplateContext=(editor,data)=>Object.assign({},{iframe:(0,_options.getIframe)(editor)},data);function getQS(query,variable){for(var vars=query.split("&"),i=0;i<vars.length;i++){var pair=vars[i].split("=");if(decodeURIComponent(pair[0])==variable)return decodeURIComponent(pair[1])}return"Response"}const displayDialogue=async function(editor){let data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const modal=await _modal_factory.default.create({type:_modal.default.TYPE,templateContext:getTemplateContext(editor,data),large:!0});modal.show();const iframe=document.getElementById("PESiframe"),src=iframe.src;window.addEventListener?(eventMethod="addEventListener",messageEvent="message"):window.postMessage?(eventMethod="attachEvent",messageEvent="onmessage"):editor.execCommand("mceInsertContent",!1,"Sorry, your web browser is not compatible with this feature.");var evX=window[eventMethod];evX(messageEvent,(function(e){var data=String(e.data);if(data.indexOf("ID=")>-1&&(data.indexOf("&source=moodle")>-1||data.indexOf("&source=Moodle")>-1)){decodeURIComponent(getQS(src,"pagetype"));if("true"==decodeURIComponent(getQS(src,"assign"))){var title=decodeURIComponent(getQS(data,"title"));title=title.split("+").join(" "),data.indexOf("delta=")>-1?(editor.execCommand("mceInsertContent",!1,'<a href="'+getQS(src,"estream_url")+"/View.aspx?"+data+'" target="_blank">'+title+"</a><br><br>"),modal.destroy()):(editor.execCommand("mceInsertContent",!1,'<a href="'+getQS(src,"estream_url")+"/View.aspx?"+data+'&delta=ESDLTA" target="_blank">'+title+"</a><br><br>"),modal.destroy())}else"0"==getQS(src,"estream_width")&&"0"==getQS(src,"estream_height")?data.indexOf("delta=")>-1?(editor.execCommand("mceInsertContent",!1,'<div style="position:relative;overflow:hidden;padding-top:56.25%;"><iframe allow="autoplay; fullscreen" allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;border:0;" src="'+getQS(src,"estream_url")+"/Embed.aspx?"+data+'" ></iframe></div>'),modal.destroy()):(editor.execCommand("mceInsertContent",!1,'<div style="position:relative;overflow:hidden;padding-top:56.25%;"><iframe allow="autoplay; fullscreen" allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;border:0;" src="'+getQS(src,"estream_url")+"/Embed.aspx?"+data+'&delta=ESDLTA" ></iframe></div>'),modal.destroy()):data.indexOf("delta=")>-1?(editor.execCommand("mceInsertContent",!1,'<iframe allow="autoplay; fullscreen" allowfullscreen style="width: '+getQS(src,"estream_width")+"px; height: "+getQS(src,"estream_height")+'px; border: 0;" src="'+getQS(src,"estream_url")+"/Embed.aspx?"+data+'" ></iframe>'),modal.destroy()):(editor.execCommand("mceInsertContent",!1,'<iframe allow="autoplay; fullscreen" allowfullscreen style="width: '+getQS(src,"estream_width")+"px; height: "+getQS(src,"estream_height")+'px; border: 0;" src="'+getQS(src,"estream_url")+"/Embed.aspx?"+data+'&delta=ESDLTA" ></iframe>'),modal.destroy())}}),!1)}}));

//# sourceMappingURL=ui.min.js.map