import Modal from"tiny_estream/modal";import ModalFactory from"core/modal_factory";import{getIframe}from"./options";let handleAction=e=>{displayDialogue(e)},getTemplateContext=(e,t)=>Object.assign({},{iframe:getIframe(e)},t);function getQS(e,t){for(var a=e.split("&"),o=0;o<a.length;o++){var r=a[o].split("=");if(decodeURIComponent(r[0])==t)return decodeURIComponent(r[1])}return"Response"}let displayDialogue=async(a,e={})=>{let o=await ModalFactory.create({type:Modal.TYPE,templateContext:getTemplateContext(a,e),large:!0});o.show();let r=document.getElementById("PESiframe").src;window.addEventListener?(eventMethod="addEventListener",messageEvent="message"):window.postMessage?(eventMethod="attachEvent",messageEvent="onmessage"):a.execCommand("mceInsertContent",!1,"Sorry, your web browser is not compatible with this feature."),(0,window[eventMethod])(messageEvent,function(e){var t,e=String(e.data);-1<e.indexOf("ID=")&&(-1<e.indexOf("&source=moodle")||-1<e.indexOf("&source=Moodle"))&&(decodeURIComponent(getQS(r,"pagetype")),"true"==decodeURIComponent(getQS(r,"assign"))?(t=(t=decodeURIComponent(getQS(e,"title"))).split("+").join(" "),-1<e.indexOf("delta=")?a.execCommand("mceInsertContent",!1,'<a href="'+getQS(r,"estream_url")+"/Embed.aspx?"+e+'" target="_blank">'+t+"</a><br><br>"):a.execCommand("mceInsertContent",!1,'<a href="'+getQS(r,"estream_url")+"/Embed.aspx?"+e+'&delta=ESDLTA" target="_blank">'+t+"</a><br><br>")):"0"==getQS(r,"estream_width",!0)&&"0"==getQS(r,"estream_height",!0)?-1<e.indexOf("delta=")?a.execCommand("mceInsertContent",!1,'<div style="position:relative;overflow:hidden;padding-top:56.25%;"><iframe allow="autoplay; fullscreen" allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;border:0;" src="'+getQS(r,"estream_url",!0)+"/Embed.aspx?"+e+'" ></iframe></div>'):a.execCommand("mceInsertContent",!1,'<div style="position:relative;overflow:hidden;padding-top:56.25%;"><iframe allow="autoplay; fullscreen" allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;border:0;" src="'+getQS(r,"estream_url",!0)+"/Embed.aspx?"+e+'&delta=ESDLTA" ></iframe></div>'):-1<e.indexOf("delta=")?a.execCommand("mceInsertContent",!1,'<iframe allow="autoplay; fullscreen" allowfullscreen style="width: '+getQS(r,"estream_width")+"px; height: "+getQS(r,"estream_height")+'px; border: 0;" src="'+getQS(r,"estream_url")+"/Embed.aspx?"+e+'" ></iframe>'):a.execCommand("mceInsertContent",!1,'<iframe allow="autoplay; fullscreen" allowfullscreen style="width: '+getQS(r,"estream_width")+"px; height: "+getQS(r,"estream_height")+'px; border: 0;" src="'+getQS(r,"estream_url")+"/Embed.aspx?"+e+'&delta=ESDLTA" ></iframe>'),o.destroy())},!1)};export{handleAction};
//# sourceMappingURL=ui.min.js.map